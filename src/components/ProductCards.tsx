"use client";

import React, { useMemo } from "react";
import Link from "next/link";
import { useLanguage } from "@/contexts/LanguageContext";
import { useSiteSettings } from "@/contexts/SiteSettingsContext";
import productCardsBg from "@/images/products-section-bg.png";
import ProductCard from "./ProductCard";

const ProductCards: React.FC = () => {
  const { language } = useLanguage();
  const { settings } = useSiteSettings();

  // type: "favorites_of_season" olan section'ı bul
  const favoritesSection = useMemo(() => {
    return settings?.sections?.find(
      (section) => section.type === "favorites_of_season"
    );
  }, [settings?.sections]);

  // Product'ları oluştur
  const products = useMemo(() => {
    if (!favoritesSection) {
      return [];
    }

    const productList = [];
    
    if (favoritesSection.product_1) {
      const product1 = favoritesSection.product_1;
      const images1: string[] = Array.isArray(product1.images) 
        ? product1.images.map((img: string | { id: number; image: string }) => 
            typeof img === 'string' ? img : img?.image || ''
          ).filter(Boolean) as string[]
        : [];
      productList.push({
        id: product1.id,
        category: language === "en" ? (product1.title_en || product1.title_tr) : product1.title_tr,
        images: images1,
      });
    }

    if (favoritesSection.product_2) {
      const product2 = favoritesSection.product_2;
      const images2: string[] = Array.isArray(product2.images) 
        ? product2.images.map((img: string | { id: number; image: string }) => 
            typeof img === 'string' ? img : img?.image || ''
          ).filter(Boolean) as string[]
        : [];
      productList.push({
        id: product2.id,
        category: language === "en" ? (product2.title_en || product2.title_tr) : product2.title_tr,
        images: images2,
      });
    }

    if (favoritesSection.product_3) {
      const product3 = favoritesSection.product_3;
      const images3: string[] = Array.isArray(product3.images) 
        ? product3.images.map((img: string | { id: number; image: string }) => 
            typeof img === 'string' ? img : img?.image || ''
          ).filter(Boolean) as string[]
        : [];
      productList.push({
        id: product3.id,
        category: language === "en" ? (product3.title_en || product3.title_tr) : product3.title_tr,
        images: images3,
      });
    }

    return productList;
  }, [favoritesSection, language]);

  // Eğer section bulunamazsa, fallback olarak boş render et
  if (!favoritesSection) {
    return null;
  }

  const subtitle = language === "en"
    ? favoritesSection.subtitle_en
    : favoritesSection.subtitle_tr;
  const title = language === "en"
    ? favoritesSection.title_en
    : favoritesSection.title_tr;
  const buttonText = language === "en"
    ? favoritesSection.button_text_left_en || favoritesSection.button_text_left_tr
    : favoritesSection.button_text_left_tr;
  const buttonUrl = favoritesSection.button_url_left;

  return (
    <section
      className="product-cards-section"
      style={{ backgroundImage: `url(${productCardsBg.src})` }}
    >
      <div className="product-cards-container">
        <div className="product-cards-header">
          <div className="product-cards-logo">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="62"
              height="33"
              viewBox="0 0 62 33"
              fill="none"
            >
              <path
                d="M13.9561 29.9902C14.0067 30.0376 14.2525 30.2408 14.4916 30.3596C14.7307 30.4758 14.8584 30.4167 14.9299 30.3937C15.3021 30.2738 16.6728 27.8838 16.9808 27.102C17.1209 26.7462 17.1472 26.4287 17.0859 26.161C16.9333 25.5962 16.56 25.0538 15.9631 24.5353C15.3659 24.0173 14.6874 23.5153 13.9286 23.0275C13.1674 22.5406 12.4012 22.0689 11.6262 21.6109C10.8513 21.155 9.91258 20.4534 9.74968 20.3049C9.69048 20.2511 9.64282 20.1817 9.60727 20.1044C9.47411 19.8143 9.55933 19.4698 9.78852 19.2486C9.8498 19.1895 9.91759 19.1338 10.0075 19.0493L16.5927 13.3138C16.8882 13.0726 17.0723 12.8995 17.1435 12.7932C17.2187 12.6902 17.2675 12.5128 17.2061 12.2781C17.1658 12.1234 17.0409 11.9362 16.8919 11.6983C16.7417 11.4614 16.5614 11.2383 16.3536 11.0304C16.1445 10.8253 15.9142 10.6624 15.6599 10.5429C15.4084 10.4273 15.1329 10.3976 14.8373 10.4602C14.0088 10.6762 13.2926 11.0912 12.6892 11.7076C12.0859 12.324 11.5047 12.986 10.9464 13.6902C10.3894 14.3963 9.80708 15.0581 9.20371 15.6733C8.60285 16.2902 7.91986 16.8891 7.10041 16.8766C6.17969 16.8624 6.01794 15.7616 5.97623 15.2722C5.72983 12.3862 5.30907 6.67251 5.00355 3.72685C4.99718 3.66582 4.97109 3.54535 4.95425 3.48685C4.94536 3.45597 4.93088 3.39986 4.92157 3.36985C4.84173 3.10743 4.64658 2.76612 4.3035 2.36501C3.95928 1.96586 3.56368 1.58702 3.11683 1.23385C2.66862 0.877577 2.21525 0.575751 1.75478 0.325121C1.29403 0.0749246 0.80526 0.014111 0.6205 0.00203509C0.13445 -0.0301433 0.0123281 0.326133 0.000502949 0.585223C-0.000858737 0.614293 0.000717952 0.643506 0.00315465 0.672647L2.66984 31.4622C2.70653 31.7869 2.93264 32.0794 3.18699 32.152C3.43847 32.2241 3.7202 32.2518 4.03188 32.2354C4.34364 32.2184 4.66915 32.1786 5.00957 32.1154C5.35035 32.0543 6.2753 31.8077 6.54197 31.7473C6.8075 31.6839 6.92389 31.5344 6.89393 31.2969L5.72704 23.7817C5.66555 23.4841 5.75327 23.3047 5.9887 23.2429C6.10888 23.2118 6.27745 23.2085 6.41218 23.207C6.47396 23.206 6.49833 23.2048 6.62575 23.2215C6.67484 23.231 6.721 23.2542 6.7587 23.2873C8.02105 24.3971 9.21045 25.5125 10.3304 26.6358C11.4646 27.7778 12.6729 28.8956 13.956 29.9901L13.9561 29.9902Z"
                fill="#BD631F"
              />
              <path
                d="M26.4218 16.0999C26.1564 16.0051 25.911 15.9459 25.6817 15.923C25.4527 15.9002 25.2598 15.8661 25.1035 15.8181C24.947 15.7715 24.8318 15.6446 24.758 15.44C24.684 15.2353 24.6577 14.9145 24.6791 14.4772C24.699 14.0408 24.7792 13.4245 24.9182 12.6242C24.987 12.2609 25.1773 12.0047 25.4879 11.8567C25.8008 11.7104 26.1539 11.6295 26.5521 11.6131C26.9474 11.5985 27.357 11.6199 27.7789 11.6775C28.1273 11.7245 28.4313 11.7682 28.689 11.8083C28.7908 11.8243 28.8942 11.8103 28.9887 11.7688C29.0555 11.7393 29.1029 11.6787 29.1147 11.6061C29.2455 10.8058 30.0234 6.07144 30.3767 4.41299C30.4073 4.26902 30.4878 4.07247 30.5743 3.88685C30.7959 3.41083 31.207 3.04154 31.7131 2.91593C31.8272 2.88766 31.9448 2.87168 32.0604 2.87558C32.3257 2.88469 32.6139 2.96894 32.9268 3.16049C33.2425 3.35117 33.5329 3.58481 33.7982 3.86212C34.1527 4.22809 34.4196 4.62529 34.6046 5.05605C34.6825 5.23762 34.7018 5.43865 34.6679 5.63345C34.3786 7.29704 33.1321 10.3854 32.8843 12.021C32.8553 12.2127 33.007 12.3519 33.2473 12.436C33.4876 12.5192 33.748 12.59 34.0249 12.6475C34.3015 12.7062 34.5543 12.7656 34.7847 12.8238C35.0127 12.8825 35.0728 12.9712 35.0914 13.0941C35.1633 13.5648 35.0923 14.238 35.0232 14.7738C34.8743 15.9261 34.7996 17.5582 34.0122 17.6405C33.8783 17.6543 31.9939 17.5168 31.357 17.706C31.1569 17.7655 30.8452 18.024 30.7892 18.3226C30.6841 18.8811 30.4933 19.904 30.438 20.2634C30.3578 20.7851 30.3004 21.3419 30.2702 21.9357C30.2378 22.5287 30.2428 23.1338 30.2828 23.7516C30.324 24.3674 30.448 24.9302 30.6558 25.4368C30.8636 25.944 31.1692 26.3714 31.5672 26.7195C31.9653 27.0673 32.5136 27.2633 33.2123 27.3056C33.4051 27.3291 33.6381 27.303 33.916 27.2278C34.1903 27.1545 34.4718 26.9644 34.7597 26.6588C35.0452 26.3542 35.3181 25.8983 35.5786 25.2915C35.7261 24.9477 35.9192 24.1868 36.0401 23.6777C36.0863 23.4834 36.2328 23.1896 36.3746 22.9331C36.6057 22.5158 36.9765 22.1947 37.423 22.0351C37.5346 21.9953 37.6592 21.9561 37.7972 21.9199C38.1298 21.8325 38.4576 21.8002 38.7207 21.7912C39.1271 21.7775 39.5501 21.8363 39.8872 22.066C40.197 22.2771 40.3506 22.8308 40.3933 23.142C40.4644 23.6583 40.2306 24.6453 40.2081 24.8139C40.0904 25.4447 39.6297 26.8772 39.2729 27.4969C38.9162 28.1178 38.458 28.6661 37.8971 29.1409C37.335 29.6176 36.6826 29.9911 35.939 30.2639C35.1953 30.5348 34.3778 30.6385 33.4876 30.572C32.093 30.4614 30.9487 30.1483 30.0549 29.6354C29.1622 29.1207 28.4649 28.4715 27.9666 27.6896C27.4682 26.9071 27.1252 26.038 26.9376 25.0829C26.7509 24.1282 26.6594 23.1542 26.6644 22.1618C26.6694 21.169 26.7396 20.1944 26.8774 19.2364C26.9885 18.4652 27.0995 17.7517 27.2114 17.0977C27.2606 16.8085 27.1337 16.5192 26.8893 16.3602C26.7215 16.251 26.5387 16.1416 26.4218 16.0999Z"
                fill="#BD631F"
              />
              <path
                d="M41.0389 15.7015C40.7736 15.6067 40.5282 15.5475 40.2989 15.5246C40.0699 15.5018 39.877 15.4677 39.7207 15.4197C39.5642 15.3731 39.449 15.2462 39.3752 15.0416C39.3011 14.8369 39.2748 14.516 39.2963 14.0789C39.3162 13.6425 39.3964 13.0261 39.5354 12.2258C39.6042 11.8625 39.7945 11.6063 40.1051 11.4582C40.418 11.3119 40.7711 11.231 41.1692 11.2147C41.5646 11.2 41.9741 11.2216 42.396 11.279C42.7444 11.326 43.0484 11.3697 43.3061 11.4099C43.4079 11.4259 43.5113 11.4119 43.6058 11.3703C43.6727 11.3409 43.72 11.2802 43.7318 11.2077C43.8627 10.4074 44.6405 5.67306 44.9939 4.01453C45.0244 3.87063 45.1049 3.67409 45.1914 3.4884C45.413 3.01244 45.8241 2.64315 46.3302 2.51755C46.4443 2.48927 46.5619 2.47329 46.6775 2.47713C46.9429 2.48631 47.231 2.57055 47.5439 2.76203C47.8596 2.95279 48.15 3.18635 48.4153 3.46366C48.7698 3.8297 49.0367 4.22691 49.2217 4.65766C49.2996 4.83916 49.3189 5.04019 49.285 5.23507C48.9957 6.89858 47.7492 9.98699 47.5014 11.6226C47.4724 11.8143 47.6241 11.9536 47.8644 12.0375C48.1047 12.1208 48.3651 12.1915 48.6421 12.2491C48.9187 12.3078 49.1714 12.3672 49.4018 12.4254C49.6298 12.4841 49.69 12.5728 49.7085 12.6957C49.7804 13.1664 49.7094 13.8395 49.6403 14.3754C49.4913 15.5276 49.4167 17.1598 48.6293 17.2421C48.4954 17.2559 46.611 17.1184 45.9741 17.3076C45.774 17.3671 45.4624 17.6256 45.4063 17.9242C45.3012 18.4827 45.1104 19.5056 45.0551 19.865C44.9749 20.3867 44.9175 20.9436 44.8874 21.5373C44.8549 22.1303 44.8599 22.7354 44.8999 23.3532C44.9411 23.969 45.0651 24.5318 45.2729 25.0384C45.4807 25.5455 45.7863 25.973 46.1843 26.321C46.5824 26.6689 47.1307 26.8649 47.8294 26.9073C48.0223 26.9306 48.2552 26.9046 48.5331 26.8295C48.8074 26.7561 49.089 26.566 49.3768 26.2604C49.6623 25.9559 49.9352 25.4999 50.1957 24.8932C50.3432 24.5493 50.5363 23.7885 50.6573 23.2793C50.7034 23.0851 50.8499 22.7912 50.9917 22.5348C51.2229 22.1175 51.5936 21.7964 52.0402 21.6368C52.1517 21.597 52.2763 21.5578 52.4143 21.5215C52.7469 21.4342 53.0748 21.4018 53.3378 21.3928C53.7442 21.3792 54.1673 21.4379 54.5043 21.6676C54.8139 21.8788 54.9677 22.4324 55.0104 22.7436C55.0815 23.2599 54.8477 24.2468 54.8252 24.4155C54.7076 25.0463 54.2468 26.4787 53.89 27.0985C53.5333 27.7194 53.0751 28.2676 52.5142 28.7424C51.9521 29.2193 51.2998 29.5927 50.5561 29.8654C49.8124 30.1363 48.9949 30.24 48.1047 30.1735C46.7102 30.063 45.5658 29.7498 44.672 29.237C43.7793 28.7222 43.0821 28.0731 42.5837 27.2912C42.0853 26.5086 41.7423 25.6395 41.5547 24.6844C41.368 23.7297 41.2765 22.7557 41.2815 21.7633C41.2866 20.7706 41.3567 19.796 41.4945 18.8379C41.6056 18.0667 41.7166 17.3532 41.8284 16.6992C41.8777 16.41 41.7508 16.1206 41.5063 15.9617C41.3385 15.8525 41.1558 15.7432 41.0388 15.7014L41.0389 15.7015Z"
                fill="#BD631F"
              />
              <path
                d="M18.5375 14.4473L22.3045 12.9772C22.6534 12.8512 23.0894 12.8664 23.2829 13.0415C23.383 13.1322 23.4241 13.2724 23.4253 13.4084L22.2514 29.6343C22.2291 29.9192 21.9945 30.1395 21.7112 30.1415L18.8441 30.162C18.5426 30.1641 18.2967 29.9194 18.2945 29.6151L18.1886 14.965C18.1869 14.7361 18.3258 14.53 18.5375 14.4473V14.4473ZM16.5457 8.14181C16.4726 7.57323 16.686 6.95736 16.9802 6.43014C17.2745 5.90263 17.6496 5.44483 18.1058 5.05384C18.561 4.66365 19.075 4.35322 19.6444 4.12407C20.2143 3.89477 20.7725 3.77799 21.3182 3.77365C21.7401 3.77032 22.112 3.86201 22.4375 4.04705C22.7606 4.23072 23.0355 4.47391 23.2614 4.77226C23.4875 5.07062 23.6573 5.40715 23.7721 5.78136C23.8865 6.15499 23.9445 6.51655 23.9474 6.86711C23.9518 7.39202 23.8879 7.8854 23.7545 8.35007C23.6214 8.81459 23.412 9.22156 23.1299 9.57292C22.8461 9.92623 22.4954 10.209 22.0745 10.4249C21.6541 10.6404 21.158 10.7492 20.5871 10.7533C20.2891 10.7556 19.9089 10.683 19.4503 10.5373C18.9886 10.3905 18.5474 10.193 18.1234 9.94691C17.6986 9.70026 17.3323 9.41593 17.0179 9.09285C16.7041 8.77048 16.5796 8.40567 16.5457 8.14181H16.5457Z"
                fill="#BD631F"
              />
              <path
                d="M56.5922 14.1606L60.3593 12.6906C60.7082 12.5646 61.1441 12.5798 61.3376 12.7549C61.4377 12.8456 61.4789 12.9858 61.48 13.1217L60.3061 29.3476C60.2839 29.6325 60.0493 29.8529 59.766 29.8548L56.8989 29.8753C56.5974 29.8774 56.3514 29.6327 56.3493 29.3285L56.2433 14.6784C56.2416 14.4494 56.3806 14.2433 56.5922 14.1606V14.1606ZM54.6004 7.85511C54.5273 7.28653 54.7407 6.67073 55.0349 6.14344C55.3292 5.616 55.7043 5.15813 56.1604 4.76714C56.6156 4.37695 57.1297 4.06652 57.699 3.83744C58.2689 3.60807 58.8271 3.49129 59.3729 3.48702C59.7948 3.48377 60.1667 3.57539 60.4921 3.76043C60.8152 3.94417 61.09 4.18735 61.3159 4.48564C61.542 4.78399 61.7119 5.1206 61.8267 5.49474C61.9411 5.86837 61.9991 6.22992 62.002 6.58049C62.0064 7.10547 61.9426 7.59877 61.8091 8.06344C61.676 8.5279 61.4667 8.93493 61.1846 9.28629C60.9008 9.63961 60.5501 9.92234 60.1291 10.1382C59.7088 10.3537 59.2127 10.4625 58.6418 10.4666C58.3438 10.4689 57.9636 10.3963 57.505 10.2507C57.0433 10.1039 56.602 9.90636 56.1781 9.66007C55.7533 9.41363 55.3871 9.12931 55.0727 8.80615C54.7587 8.48386 54.6343 8.11898 54.6005 7.85511H54.6004Z"
                fill="#BD631F"
              />
            </svg>
          </div>
          {/* {title && (
            <h2 className="product-cards-title">{title}</h2>
          )} */}
          {subtitle && (
            <p className="product-cards-description">
              {subtitle}
            </p>
          )}
        </div>

        {products.length > 0 && (
          <div className="product-cards-grid">
            {products.map((product) => (
              <ProductCard
                key={product.id}
                category={product.category}
                images={product.images}
              />
            ))}
          </div>
        )}

        {buttonText && (
          buttonUrl ? (
            <Link href={buttonUrl} className="explore-button" style={{ textDecoration: 'none' }}>
              {buttonText}
            </Link>
          ) : (
            <button className="explore-button">
              {buttonText}
            </button>
          )
        )}
      </div>
    </section>
  );
};

export default ProductCards;
